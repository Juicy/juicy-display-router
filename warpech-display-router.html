<script>
  /**
   * warpech-display-router 0.1.2
   * MIT license
   */
  (function (global) {
    var pushState = global.history.pushState;
    global.history.pushState = function (state) {
      var out = pushState.apply(history, arguments);
      var event = new CustomEvent("warpech-display-router-pushstate");
      global.dispatchEvent(event);
      return out;
    };

    var WarpechDisplayRoutePrototype = Object.create(HTMLElement.prototype);
    WarpechDisplayRoutePrototype.checkMatching = function () {
      if (window.location.pathname.match(this.matchPath)) {
        this.applyDisplaySelector(true);
      }
      else {
        this.applyDisplaySelector(false);
      }
    };
    WarpechDisplayRoutePrototype.applyDisplaySelector = function (show) {
      var selector = this.getAttribute('display-selector');
      if (selector) {
        var elem = document.querySelector(selector);
        if (elem) {
          if (show) {
            elem.style.display = "";
            elem.dispatchEvent(new CustomEvent("resize",{bubbles: false}));
          }
          else {
            elem.style.display = "none";
          }
        }
      }
    };
    WarpechDisplayRoutePrototype.attributeChangedCallback = function (attributeName, oldVal, newVal) {
      if (attributeName == 'match-path') {
        this.matchPath = new RegExp(newVal, "i");
      }
    };
    WarpechDisplayRoutePrototype.attachedCallback = function () { //needs to be 'attached' not 'created', otherwise does not work with Polymer's TemplateBinding in attributes
      this.attributeChangedCallback('match-path', '', this.getAttribute('match-path'));

      global.addEventListener('warpech-display-router-pushstate', this.checkMatching.bind(this));
      global.addEventListener('popstate', this.checkMatching.bind(this));
      this.checkMatching();
    };

    global.WarpechDisplayRouteElement = document.registerElement('warpech-display-route', {
      prototype: WarpechDisplayRoutePrototype
    });
  })(window);
</script>
